<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±é›„æ—…ç¨‹æ•…äº‹ç”¢ç”Ÿå™¨</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f3f4f6;
            --text-color: #1f2937;
            --card-bg-color: #ffffff;
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --border-color: #e5e7eb;
            --input-bg-color: #f9fafb;
            --input-border-color: #d1d5db;
            --primary-color: #10b981; /* green-600 */
            --primary-hover-color: #059669; /* green-700 */
            --primary-focus-ring: rgba(52, 211, 153, 0.4);
            --heading-color: #111827;
            --muted-text-color: #6b7280;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #111827;
                --text-color: #e5e7eb;
                --card-bg-color: #1f2937;
                --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
                --border-color: #374151;
                --input-bg-color: #374151;
                --input-border-color: #4b5563;
                --primary-color: #34d399; /* green-400 */
                --primary-hover-color: #10b981; /* green-500 */
                --primary-focus-ring: rgba(110, 231, 183, 0.4);
                --heading-color: #ffffff;
                --muted-text-color: #9ca3af;
            }
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 56rem; /* 896px */
            margin: 0 auto;
            padding: 1rem;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
        }

        header h1 {
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--heading-color);
        }

        header p {
            margin-top: 0.5rem;
            font-size: 1.125rem;
            color: var(--muted-text-color);
        }

        .form-section {
            background-color: var(--card-bg-color);
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 2rem;
            transition: background-color 0.3s;
        }
        
        .form-section h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        
        .form-group {
            margin-top: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-color);
        }

        input[type="text"],
        input[type="password"],
        textarea {
            width: 100%;
            background-color: var(--input-bg-color);
            border: 1px solid var(--input-border-color);
            color: var(--text-color);
            font-size: 0.875rem;
            border-radius: 0.5rem;
            padding: 0.75rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        input[type="text"]:focus,
        input[type="password"]:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px var(--primary-focus-ring);
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }

        .api-key-note {
            font-size: 0.75rem;
            color: var(--muted-text-color);
            margin-top: 0.5rem;
        }

        .stage-card {
            background-color: var(--input-bg-color);
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            margin-bottom: 1rem;
        }

        .stage-card h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .stage-card p {
            font-size: 0.875rem;
            color: var(--muted-text-color);
            margin-top: 0.25rem;
            margin-bottom: 0.75rem;
        }
        
        .submit-container {
            margin-top: 2rem;
        }

        .submit-button {
            width: 100%;
            color: #ffffff;
            background-color: var(--primary-color);
            font-weight: 500;
            border-radius: 0.5rem;
            font-size: 1.125rem;
            padding: 0.85rem 1.25rem;
            text-align: center;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        .submit-button:hover {
            background-color: var(--primary-hover-color);
            transform: scale(1.02);
        }
        
        .submit-button:focus {
            outline: none;
            box-shadow: 0 0 0 4px var(--primary-focus-ring);
        }
        
        .submit-button:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .output-section {
            margin-top: 2rem;
            display: none;
        }
        
        .output-section.visible {
            display: block;
        }

        #story-output {
            white-space: pre-wrap;
            line-height: 1.6;
        }

        .loader {
            width: 28px;
            height: 28px;
            border: 3px solid #FFF;
            border-bottom-color: transparent;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }

        .copy-button {
            margin-top: 1rem;
            color: var(--text-color);
            background-color: transparent;
            border: 1px solid var(--border-color);
            font-weight: 500;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: background-color 0.3s, border-color 0.3s;
        }

        .copy-button:hover {
            background-color: var(--input-bg-color);
            border-color: var(--primary-color);
        }
        
        .copy-button:focus {
            outline: none;
            box-shadow: 0 0 0 3px var(--primary-focus-ring);
        }

        .copy-success {
            background-color: var(--primary-color) !important;
            color: #ffffff !important;
        }
        
        @media (min-width: 768px) {
            .container {
                padding: 2rem;
            }
            header h1 {
                font-size: 3rem;
            }
            .form-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>è‹±é›„æ—…ç¨‹æ•…äº‹ç”¢ç”Ÿå™¨</h1>
            <p>ä¾ç…§ç¶“å…¸æ•˜äº‹çµæ§‹ï¼Œæ‰“é€ ä½ çš„å°ˆå±¬è‹±é›„å‚³èªªã€‚</p>
        </header>

        <main id="story-form">
            <section class="form-section">
                <h2>è§’è‰²è¨­å®š</h2>
                <!-- <div class="form-group">
                    <label for="groq-api-key">Groq API Keyï¼š</label>
                    <input type="password" id="groq-api-key" placeholder="è«‹åœ¨æ­¤è¼¸å…¥æ‚¨çš„ Groq API Key">
                    <p class="api-key-note">æ‚¨çš„ API Key åªæœƒåœ¨æ‚¨çš„ç€è¦½å™¨ä¸­ä½¿ç”¨ï¼Œä¸æœƒè¢«å„²å­˜æˆ–å‚³é€è‡³ä»»ä½•ä¼ºæœå™¨ã€‚</p>
                </div> -->
                <div class="form-grid form-group">
                    <div>
                        <label for="char-name">è§’è‰²åç¨±ï¼š</label>
                        <input type="text" id="char-name" placeholder="ä¾‹å¦‚ï¼šäºç‘Ÿã€è‰å¨œ">
                    </div>
                    <div>
                        <label for="start-world">èµ·å§‹ä¸–ç•Œï¼š</label>
                        <input type="text" id="start-world" placeholder="ä¸»è§’ä¸€é–‹å§‹æ‰€è™•çš„æ—¥å¸¸ç”Ÿæ´»ç’°å¢ƒ">
                    </div>
                </div>
                <div class="form-group">
                    <label for="external-features">å¤–åœ¨ç‰¹å¾µï¼š</label>
                    <textarea id="external-features" placeholder="æ€§åˆ¥ã€å¹´é½¡ã€è·æ¥­ã€èƒŒæ™¯ç­‰"></textarea>
                </div>
                <div class="form-group">
                    <label for="internal-traits">å…§åœ¨ç‰¹è³ªï¼š</label>
                    <textarea id="internal-traits" placeholder="æ€§æ ¼ã€å¤©è³¦ã€å¼±é»ã€å…§å¿ƒçš„æ¸´æœ›/æ…¾æœ›"></textarea>
                </div>
                <div class="form-group">
                    <label for="core-weakness">æ ¸å¿ƒå¼±é»ï¼š</label>
                    <textarea id="core-weakness" placeholder="é˜»ç¤™è§’è‰²æˆé•·çš„å…§åœ¨ç¼ºé™·æˆ–éŒ¯èª¤èªçŸ¥"></textarea>
                </div>
                 <div class="form-group">
                    <label for="transformation">æ—…ç¨‹çµ‚é»çš„è›»è®Šï¼š</label>
                    <textarea id="transformation" placeholder="æ—…ç¨‹çµæŸå¾Œï¼Œä¸»è§’æœƒå¾ä»€éº¼æ¨£çš„äººè®Šæˆä»€éº¼æ¨£çš„äººï¼Ÿï¼ˆå…§åœ¨çš„æˆé•·ï¼‰"></textarea>
                </div>
            </section>

            <section class="form-section">
                <h2>è‹±é›„æ—…ç¨‹</h2>
                <div id="journey-stages">
                    <!-- Stages will be dynamically inserted here by JavaScript -->
                </div>
            </section>

            <div class="submit-container">
                <button id="generate-button" class="submit-button">
                    <span id="button-text">ç”Ÿæˆæ•…äº‹</span>
                    <div id="button-loader" class="loader hidden"></div>
                </button>
            </div>

            <section id="output-section" class="form-section output-section">
                 <h2>AI ç”Ÿæˆçš„æ•…äº‹</h2>
                 <div id="story-output"></div>
                 <button id="copy-button" class="copy-button" style="display: none;">
                    ğŸ“‹ è¤‡è£½æ•…äº‹
                 </button>
            </section>
        </main>
    </div>

    <script>
        const stages = [
            { stage: 1, title: "å¹³å‡¡ä¸–ç•Œ (Ordinary World)", meaning: "ä¸»è§’æœ€åˆçš„æ—¥å¸¸ç”Ÿæ´»ã€‚" },
            { stage: 2, title: "æ­·éšªçš„å¬å–š (Call to Adventure)", meaning: "å±æ©Ÿæˆ–æŒ‘æˆ°å‡ºç¾ã€‚" },
            { stage: 3, title: "æ‹’çµ•å¬å–š (Refusal of the Call)", meaning: "ä¸»è§’å› ææ‡¼æˆ–ä¸æƒ…é¡˜è€Œé€€ç¸®ã€‚" },
            { stage: 4, title: "é‡è¦‹å°å¸« (Meeting the Mentor)", meaning: "å°å¸«æä¾›å¹«åŠ©ã€çŸ¥è­˜æˆ–ä¿¡å¿ƒã€‚" },
            { stage: 5, title: "è·¨è¶Šç¬¬ä¸€é“é–€æª» (Crossing the Threshold)", meaning: "é€²å…¥éå‡¡ä¸–ç•Œçš„é—œéµé»ã€‚" },
            { stage: 6, title: "è€ƒé©—ã€ç›Ÿå‹èˆ‡æ•µäºº (Tests, Allies, Enemies)", meaning: "ç¶“æ­·é‡é‡è€ƒé©—ã€çµè­˜ç›Ÿå‹æˆ–é¢å°æ•µäººã€‚" },
            { stage: 7, title: "æ¥è¿‘æœ€æ·±çš„æ´ç©´ (Approach to the Innermost Cave)", meaning: "é€²å…¥æ•…äº‹ä¸–ç•Œï¼ˆæ ¸å¿ƒï¼‰çš„å±éšªå€åŸŸã€‚" },
            { stage: 8, title: "åš´å³»è€ƒé©— (Ordeal)", meaning: "é¢å°æœ€å¤§çš„æŒ‘æˆ°ï¼Œå¯èƒ½ç¶“æ­·ã€Œæ­»äº¡ã€èˆ‡ã€Œé‡ç”Ÿã€ã€‚" },
            { stage: 9, title: "çè³ (Reward)", meaning: "å­˜æ´»ä¸‹ä¾†å¾Œç²å¾—çš„å¯¶ç‰©ã€çŸ¥è­˜æˆ–èƒ½åŠ›ã€‚" },
            { stage: 10, title: "å›æ­¸ä¹‹è·¯ (The Road Back)", meaning: "å¸¶è‘—çè³é€ƒé›¢ï¼Œè¸ä¸Šè¿”å›å¹³å‡¡ä¸–ç•Œçš„è·¯é€”ã€‚" },
            { stage: 11, title: "å¾©ç”¦/å¾©æ´» (Resurrection)", meaning: "æ—…ç¨‹çµæŸå‰æœ€çµ‚ä¸”æœ€å±éšªçš„è€ƒé©—ã€‚" },
            { stage: 12, title: "å¸¶è‘—çè³å›æ­¸ (Return with the Elixir)", meaning: "å°‡æˆ°æœï¼ˆå¦‚çŸ¥è­˜ã€è‡ªç”±ã€æˆ–ç¶“é©—ï¼‰å¸¶å›åŸæœ¬çš„ä¸–ç•Œã€‚" }
        ];

        const stagesContainer = document.getElementById('journey-stages');

        stages.forEach(s => {
            const card = document.createElement('div');
            card.className = 'stage-card';
            card.innerHTML = `
                <h3>${s.stage}. ${s.title}</h3>
                <p>${s.meaning}</p>
                <textarea id="stage-${s.stage}" placeholder="ç°¡çŸ­æƒ…ç¯€æè¿°..."></textarea>
            `;
            stagesContainer.appendChild(card);
        });

        const generateButton = document.getElementById('generate-button');
        const buttonText = document.getElementById('button-text');
        const buttonLoader = document.getElementById('button-loader');
        const outputSection = document.getElementById('output-section');
        const storyOutput = document.getElementById('story-output');
        const copyButton = document.getElementById('copy-button');

        generateButton.addEventListener('click', async () => {
            setLoading(true);
            storyOutput.textContent = '';
            outputSection.classList.add('visible');

            const apiKey = '{{GROQ_API_KEY}}'; // æ­¤å€¼æœƒåœ¨éƒ¨ç½²æ™‚è¢« GitHub Actions æ›¿æ›
            if (!apiKey || apiKey.includes('{{GROQ_API_KEY}}')) {
                storyOutput.textContent = 'éŒ¯èª¤ï¼šAPI Key æœªæ­£ç¢ºé…ç½®ã€‚è«‹è¯ç¹«ç®¡ç†å“¡ã€‚';
                setLoading(false);
                outputSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                return;
            }
            
            try {
                const prompt = buildPrompt();
                
                const apiUrl = 'https://api.groq.com/openai/v1/chat/completions';

                const payload = {
                    messages: [{ role: 'user', content: prompt }],
                    model: 'openai/gpt-oss-20b',
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();

                if (!response.ok) {
                    const errorMessage = result.error?.message || `API è«‹æ±‚å¤±æ•—ï¼Œç‹€æ…‹ç¢¼ï¼š${response.status}`;
                    throw new Error(errorMessage);
                }

                if (result.choices && result.choices[0].message.content) {
                    const generatedText = result.choices[0].message.content;
                    storyOutput.textContent = generatedText;
                    copyButton.style.display = 'block';
                } else {
                    throw new Error("å¾ API æ”¶åˆ°çš„å›æ‡‰æ ¼å¼ç„¡æ•ˆã€‚");
                }
            } catch (error) {
                console.error("ç”Ÿæˆæ•…äº‹æ™‚ç™¼ç”ŸéŒ¯èª¤:", error);
                storyOutput.textContent = `ç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚\néŒ¯èª¤è¨Šæ¯ï¼š${error.message}`;
                copyButton.style.display = 'none';
            } finally {
                setLoading(false);
                outputSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });

        copyButton.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(storyOutput.textContent);
                
                // é¡¯ç¤ºæˆåŠŸç‹€æ…‹
                const originalText = copyButton.textContent;
                copyButton.textContent = 'âœ“ å·²è¤‡è£½';
                copyButton.classList.add('copy-success');
                
                // 2ç§’å¾Œæ¢å¾©åŸç‹€
                setTimeout(() => {
                    copyButton.textContent = originalText;
                    copyButton.classList.remove('copy-success');
                }, 2000);
            } catch (error) {
                console.error('è¤‡è£½å¤±æ•—:', error);
                
                // å‚™ç”¨æ–¹æ¡ˆï¼šé¸å–æ–‡æœ¬
                const range = document.createRange();
                range.selectNode(storyOutput);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
                
                copyButton.textContent = 'è«‹æ‰‹å‹•è¤‡è£½å·²é¸å–çš„æ–‡å­—';
                setTimeout(() => {
                    copyButton.textContent = 'ğŸ“‹ è¤‡è£½æ•…äº‹';
                }, 3000);
            }
        });
        
        function setLoading(isLoading) {
            if (isLoading) {
                generateButton.disabled = true;
                buttonText.classList.add('hidden');
                buttonLoader.classList.remove('hidden');
            } else {
                generateButton.disabled = false;
                buttonText.classList.remove('hidden');
                buttonLoader.classList.add('hidden');
            }
        }

        function buildPrompt() {
            const charName = document.getElementById('char-name').value;
            const startWorld = document.getElementById('start-world').value;
            const externalFeatures = document.getElementById('external-features').value;
            const internalTraits = document.getElementById('internal-traits').value;
            const coreWeakness = document.getElementById('core-weakness').value;
            const transformation = document.getElementById('transformation').value;
            
            let journeyPrompt = '';
            stages.forEach(s => {
                const plotPoint = document.getElementById(`stage-${s.stage}`).value;
                if (plotPoint) {
                   journeyPrompt += `\n- ${s.title}: ${plotPoint}`;
                }
            });

            return `
æ‚¨æ˜¯ä¸€ä½å°ˆæ¥­çš„æ•…äº‹ä½œå®¶ã€‚è«‹æ ¹æ“šä»¥ä¸‹æä¾›çš„ã€Œè§’è‰²è¨­å®šã€å’Œã€Œè‹±é›„æ—…ç¨‹æƒ…ç¯€ã€ï¼Œå°‡é€™äº›é›¶æ•£çš„è¦é»ä¸²é€£æˆä¸€å€‹æµæš¢ã€ç”Ÿå‹•ã€å¼•äººå…¥å‹çš„å®Œæ•´æ•…äº‹ã€‚è«‹æ“´å±•æƒ…ç¯€æè¿°ï¼Œå¢åŠ ç´°ç¯€å’Œæƒ…æ„Ÿè½‰æŠ˜ï¼Œè®“æ•…äº‹æ›´å…·å¯è®€æ€§ã€‚
è¨˜å¾—åªéœ€è¦å®Œæ•´çš„æ•…äº‹å…§å®¹ï¼Œä¸éœ€è¦é‡è¤‡æä¾›è§’è‰²è¨­å®šæˆ–æƒ…ç¯€è¦é»ï¼Œå›å‚³ç´”æ–‡å­—ï¼Œä¸è¦ä½¿ç”¨Markdownèªæ³•ã€‚

### è§’è‰²è¨­å®š
- **è§’è‰²åç¨±**: ${charName || 'æœªå‘½å'}
- **èµ·å§‹ä¸–ç•Œ**: ${startWorld || 'æœªæä¾›'}
- **å¤–åœ¨ç‰¹å¾µ**: ${externalFeatures || 'æœªæä¾›'}
- **å…§åœ¨ç‰¹è³ª**: ${internalTraits || 'æœªæä¾›'}
- **æ ¸å¿ƒå¼±é»**: ${coreWeakness || 'æœªæä¾›'}
- **æœ€çµ‚è›»è®Š**: ${transformation || 'æœªæä¾›'}

### è‹±é›„æ—…ç¨‹æƒ…ç¯€
${journeyPrompt || 'æœªæä¾›ä»»ä½•æƒ…ç¯€ã€‚è«‹æ ¹æ“šè§’è‰²è¨­å®šè‡ªç”±ç™¼æ®ã€‚'}

è«‹é–‹å§‹æ’°å¯«å®Œæ•´çš„æ•…äº‹ï¼š
`;
        }

    </script>
</body>
</html>

